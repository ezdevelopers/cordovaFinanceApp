<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="theme-color" content="#517aa0">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1">
    <title>Finance</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <ul id="slide-out" class="side-nav">
        <li>
            <div class="user-view">
                <span class="name"></span>
                <span class="email"><span>
            </div>
        </li>

        <li><a class="waves-effect" href="home.html">Home</a></li>
        <li><a class="waves-effect" href="create.html">Create Report</a></li>
        <li><a class="waves-effect" href="view.html">View Report</a></li>
        <li><a class="waves-effect" href="approve.html">Approve Report<a></li>
        <li><a class="waves-effect" href="#!">Settings</a></li>
        <li><a class="waves-effect" href="index.html">Log Out</a></li>

    </ul>

    <nav class="nav-extended">
        <div class="nav-wrapper">
            <a href="#" data-activates="slide-out" class="button-collapse"><i class="meduim material-icons">menu</i></a>
            <a href="#">Create Report</a>

        </div>
        <div class="nav-content">
            <ul class="tabs tabs-transparent">
                <li class="tab"><a class="active" href="#testa">Attendance</a></li>
                <li class="tab"><a href="#testb">Finance</a></li>
                <li class="tab"><a href="#testc">Others</a></li>
            </ul>
        </div>
    </nav>
    <div id="testa" class="col s12">
        <div class="container">
            <form id="attendance">
               <div class="attend"></div>
            </form>
        </div>
    </div>
    <div id="testb" class="col s12 test">
        <form class="col s12">
            <div class="row">
                <li><a class="subheader">Income</a></li>
                <div class="input-field col s12">
                    <input id="investment" type="number" class="validate">
                    <label for="investment" style="color:#517aa0;">Investment</label>
                </div>
                <div class="input-field col s12">
                    <input id="other" type="number" class="validate">
                    <label for="other" style="color:#517aa0;">Other Income</label>
                </div>
            </div>
            <div class="row">
                <li><a class="subheader">Vows</a></li>
                <div class="col s9">
                    <div class="input-field">
                        <i class="material-icons prefix">phone</i>
                        <input id="icon_telephone" type="tel" class="validate">
                        <label for="icon_telephone" style="color:#517aa0;">Telephone</label>
                    </div>

                    <div class="input-field">
                        <i class="material-icons prefix">monetization_on</i>
                        <input id="vow_amount" type="number" class="validate">
                        <label for="vow_amount" style="color:#517aa0;">Amount</label>
                    </div>
                    <p>
                        <input type="checkbox" id="testpaid" />
                        <label for="testpaid">Paid</label>
                    </p>
                    <div id="vows"></div>
                </div>
                <div class="input-field col s3">
                    <i class="medium material-icons" id="addMore">add</i>
                </div>
            </div>
            <div class="row">
                <li><a class="subheader">Expenses</a></li>
                <div class="input-field col s12">
                    <input id="refresh" type="number" class="validate">
                    <label for="refresh" style="color:#517aa0;">Refreshment</label>
                </div>
                <div class="input-field col s12">
                    <input id="venue" type="number" class="validate">
                    <label for="venue" style="color:#517aa0;">Venue Rentals</label>
                </div>
                <div class="input-field col s12">
                    <input id="hon" type="number" class="validate">
                    <label for="hon" style="color:#517aa0;">Honorarium</label>
                </div>
                <div class="input-field col s12">
                    <input id="misc" type="number" class="validate">
                    <label for="misc" style="color:#517aa0;">Miscellaneous</label>
                </div>

            </div>
            <div style="margin-bottom:80px;"></div>
        </form>
    </div>
    <div id="testc" class="col s12 test">
        <form class="col s12">
            <div class="row">
                <li><a class="subheader">Others</a></li>
                <div class="input-field col s12">
                    <input id="salvation" type="number" class="validate">
                    <label for="salvation" style="color:#517aa0;">Salvation</label>
                </div>
                <div class="input-field col s12">
                    <input id="reded" type="number" class="validate">
                    <label for="reded" style="color:#517aa0;">Re-dedication</label>
                </div>
                <div class="input-field col s12">
                    <input id="voice" type="number" class="validate">
                    <label for="voice" style="color:#517aa0;">Voice Magazine</label>
                </div>
            </div>
            <div style="margin-bottom:80px;"></div>
        </form>
    </div>

    <div class="bottom-content">
        <div class="container">
  <select class="browser-default" id="events">
      <option value="" disabled selected>Choose Event</option>
    </select>

            <button id="save" class="btn waves-effect waves-light" type="submit" name="action">Save All
                <i class="material-icons right">save</i>
            </button>

        </div>
    </div>


    <script src="js/jquery-3.2.1.min.js"></script>
    <script src="js/materialize.min.js"></script>
    <script src="js/script.js"></script>
    <script>
                // Initialize collapse button
        $(".button-collapse").sideNav();
        // Initialize collapsible (uncomment the line below if you use the dropdown variation)
        $('.collapsible').collapsible();

        var member = JSON.parse(localStorage.getItem("chapterMembers"));

        for(var i = 0; i < member.length; i++){
            $(".attend").append("<p>" + "<input type=\"checkbox\" " +"name=\"attendance\""+ "id=\"" + member[i].id + "\"/> <label for=\"" +  member[i].id + "\">" + member[i].name+ "</label></p>");
        }
        var data = {
            "chapterId":localStorage.getItem("eventId")
        }
        $.ajax({
            type: "POST",
            contentType: 'application/json; charset=UTF-8',
            url: "http://192.168.0.43/api/v1/getEvents",
            data:JSON.stringify(data),
            processData: true,
            dataType: "json"
        }).done(successFn).fail(errorFn);
        //This function check the response from the server and looks 
        //for a token field, if token id found it stores the token in
        //local storage else it returns an error.      
        function successFn(result) {
            for (var elm in result) {
                    events.push(result[elm]);
                }
            localStorage.setItem('theEvents', JSON.stringify(events[0]));
        };
        //if there is an error in the ajax request display the error
        function errorFn(xhr, status, strErr) {
            alert("Something went wrong, Could not retrieve Events");
        };
        
        var localEvents = JSON.parse(localStorage.getItem("theEvents"));

            for(var i = 0; i < localEvents.length; i++){
            $("#events").append("<option value=\"" + localEvents[i].eventId + "\">" + localEvents[i].title + "</option>"); 
        }
        
        $("#save").click(function(e){
            e.preventDefault();
            var eventID = $("#events").val();
            console.log(eventID)
            var favorite = [];
            $.each($("input[name='attendance']:checked"), function(){            
                favorite.push($(this).attr('id'));
            });
            var attendance = favorite.join(", ");
            console.log(attendance);
            
            var values = {
                "eventId" : eventID,
                "attendance": attendance
            };
                $.ajax({
            type: "POST",
            contentType: 'application/json; charset=UTF-8',
            url: "http://192.168.0.43/api/v1/postAttendance",
            data:JSON.stringify(values),
            processData: true,
            dataType: "json"
        }).done(successFn).fail(errorFn);
        //This function check the response from the server and looks 
        //for a token field, if token id found it stores the token in
        //local storage else it returns an error.      
        function successFn(result) {
         alert("Values have been Saved");
        };
        //if there is an error in the ajax request display the error
        function errorFn(xhr, status, strErr) {
            alert("Something prevented Submission");
        };
        })
        $(function () {
            $("#addMore").click(function (e) {
                e.preventDefault();
                $("#vows").append("<div class=\"input-field\"><i class=\"material-icons prefix\">phone</i><input id=\"icon_telephone\" type=\"tel\" class=\"validate\"><label for=\"icon_telephone\" style=\"color:#517aa0;\">Telephone</label></div>");
                $("#vows").append("<div class=\"input-field\"><i class=\"material-icons prefix\">monetization_on</i><input id=\"vow_amount\" type=\"number\" class=\"validate\"><label for=\"vow_amount\" style=\"color:#517aa0;\">Amount</label></div>");
                $("#vows").append("<p><input type=\"checkbox\" id=\"testpaid\" /><label for=\"testpaid\">Paid</label></p>");
                // $("#vows").append("");
            });
        });
    </script>
</body>

</html>